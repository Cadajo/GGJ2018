<!doctype html5>
<head>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0
        }
        canvas {
            width: 600px;
            height: 600px;
        }

        #reference {
            width: 200%;
            transform: translateX(-20%) translateY(-50%);
            opacity: 0.1;
            z-index: 1;
            position: fixed;
            top: 0;
            left: 0;
        }

        .dg.ac {
            z-index: 2 !important;
        }
    </style>
</head>
<body>
<img id="reference" src="../concepts/ship+hud4.png">
<script type="text/javascript" src="dat.gui.min.js"></script>
<script>

let width, height
const canvas = document.createElement('canvas')
const ctx = canvas.getContext('2d')
document.body.appendChild(canvas)
const { random, round, abs, floor, max, PI, sin, cos } = Math
const start = Date.now()
let counter
let last = Date.now()

function getRandomColor () {
    return '#'+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6)
}

function ffor00 () {
    return round(random()) ? 'ff' : '00'
}

function getRandomNeonColor () {
    return `#${ffor00()}${ffor00()}${ffor00()}`
}

/*
window.onresize = function () {
    width = window.innerWidth
    height = window.innerHeight
    canvas.width = width * 2
    canvas.height = height * 2
    ctx.scale(2, 2)
}
window.onresize()
*/

width = height = 600
/*
width = window.innerWidth
height = window.innerHeight
/**/
canvas.style.width = canvas.style.height = width
canvas.width = width * 2
canvas.height = height * 2
ctx.scale(2, 2)
</script>
<!--<script src="render.js"></script>-->
<script>
const FPS_ENABLED = false
function renderFPS () {
    ctx.clearRect(0, 0, 50, 20)
    ctx.fillStyle = 'blue'
    ctx.fillText(delta, 20, 20)
}

function loop () {
    requestAnimationFrame(loop)
    counter = Date.now() - start
    delta = Date.now() - last
    last = Date.now()
    window.render && render()
    if (FPS_ENABLED) renderFPS()
}
ctx.fillStyle = 'white'
ctx.fillRect(0,0,width,height)
window.init && init()
loop()


// screenshot generator
document.addEventListener('keypress', function (e) {
    console.log(e)
    if (e.code === "Space") {
        // generate "screenshot"
        const frame = document.createElement('canvas')
        frame.width = frame.height = p.frameEdge*2
        const frameCtx = frame.getContext('2d')
        frameCtx.drawImage(canvas, p.frameX*2, p.frameY*2, p.frameEdge*2, p.frameEdge*2, 0, 0, p.frameEdge*2, p.frameEdge*2)
        document.body.appendChild(frame)

        const img = new Image()
        img.width = img.height = frame.width
        img.src = frame.toDataURL()
        document.body.appendChild(img)
    }
})
</script>























































<script>
const params = {
    x: 290,
    y: 297,
    radius: 60,
    hudRadius: 85,
    maxHudRadius: 180,
    hudSteps: 80,
    arcStart: 1.57,
    arcEnd: 3.8,
    hudColor: '#ffc200',
    frameX: 130,
    frameY: 240,
    frameEdge: 240
}
const p = params

function easeOutQuint (t) { return 1+(--t)*t*t*t*t }
function easeInOutQuint (t) { return t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t }
function easeOutCubic(t) { return (--t)*t*t+1 }

function render () {
    const { x, y, arcStart, arcEnd, hudRadius, maxHudRadius } = params
    ctx.clearRect(0, 0, width, height)
    ctx.beginPath()
    ctx.fillStyle = ctx.strokeStyle = params.hudColor

    ctx.strokeRect(p.frameX, p.frameY, p.frameEdge, p.frameEdge)

    ctx.arc(x, y, params.radius, 0, 2*PI)
    ctx.stroke()

    ctx.beginPath()
    ctx.arc(x, y, hudRadius, arcStart, arcEnd)
    let maxDist = 1.57, radius
    for (let i = arcEnd;
         i >= arcStart;
         i += (arcStart - arcEnd) / params.hudSteps) {
        let leftDistance = abs(i - arcEnd)
        let dist = Math.min(leftDistance, abs(arcStart - i))
        radius = (maxHudRadius - hudRadius)
                     * easeOutCubic(leftDistance/abs(arcStart - arcEnd))
                     + hudRadius
        ctx.lineTo(x + radius * cos(i), y + radius * sin(i))
    }
    i = arcStart
    ctx.lineTo(x + radius * cos(i), y + radius * sin(i))
    ctx.closePath()
    ctx.stroke()
    ctx.fill()
}

document.addEventListener('mousemove', (e) => {
    // params.offset = (e.pageX/window.innerWidth) * 50
    // params.weight = (e.pageY/window.innerHeight) * 20
    //params.fillDisplacement =  0.01 + (e.pageX/window.innerWidth) * 50
    params.fillWeight = 0.01 + (e.pageY/window.innerHeight) * 20
    params.fillDisplacement =  0.01 + (e.pageX/window.innerWidth) * 50
})
</script>
    











<script>
const gui = new dat.GUI()
for (let param in params) {
    const value = params[param]
    const isColor = (typeof value === 'string' && value[0] === '#')
    if (isColor) gui.addColor(params, param)
    else gui.add(params, param)
}
</script>
</body>